async function importRecipe() {
            const id = document.getElementById('recipeSelect').value;
            if (!id) return;

            const { data: recipe } = await supabaseClient.from('recipes').select('ingredients').eq('id', id).single();
            
            if (recipe?.ingredients) {
                const items = recipe.ingredients.map(i => ({
                    name: i.n,
                    price: i.p,
                    weight: i.w || '—',
                    kcal: i.c || 0
                }));

                await supabaseClient.from('shopping_list').insert(items);
                loadShoppingList(); // Мгновенное обновление списка
            }
        }

        async function loadShoppingList() {
            const { data } = await supabaseClient.from('shopping_list').select('*').order('id', { ascending: false });
            const listDiv = document.getElementById('shoppingList');
            
            if (data) {
                listDiv.innerHTML = data.length === 0 ? '<p style="color:#aaa;text-align:center">Список пуст</p>' : '';
                let totalSum = 0; 
                let totalKcal = 0;

                data.forEach(item => {
                    totalSum += Number(item.price || 0);
                    totalKcal += Number(item.kcal || 0);
                    
                    listDiv.innerHTML += 
                        <div class="item">
                            <div class="item-info">
                                <b>${item.name}</b>
                                <div class="tag-row">
                                    <span class="tag tag-w">${item.weight}</span>
                                    <span class="tag tag-c">${item.kcal} ккал</span>
                                    <span style="font-size: 14px; color: #999; margin-left: 5px;">${item.price} ₽</span>
                                </div>
                            </div>
                            <button class="del-btn" onclick="deleteItem(${item.id})">×</button>
                        </div>;
                });

                document.getElementById('totalSum').innerText = ${totalSum} ₽;
                document.getElementById('totalKcal').innerText = Всего: ${totalKcal} ккал;
            }
        }

        async function deleteItem(id) {
            await supabaseClient.from('shopping_list').delete().eq('id', id);
            loadShoppingList();
        }

        loadRecipes();
        loadShoppingList();
    </script>
</body>
</html>
