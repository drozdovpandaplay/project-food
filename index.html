<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Project Food: Pro Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --main: #46b8bc; --bg: #f4f7f6; --dark: #2d3436; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; color: var(--dark); }
        
        .header { background: white; padding: 15px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .page { display: none; padding: 15px; }
        .active { display: block; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { opacity:0; transform: translateY(20px); } to { opacity:1; transform: translateY(0); } }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Ä–µ—Ü–µ–ø—Ç–∞ */
        .recipe-card { background: white; border-radius: 20px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .recipe-content { padding: 15px; }
        .recipe-meta { display: flex; gap: 10px; margin: 10px 0; font-size: 12px; color: #7f8c8d; }
        .meta-item { background: #f0f3f2; padding: 4px 10px; border-radius: 8px; }
        
        .person-selector { display: flex; align-items: center; gap: 10px; margin: 15px 0; background: #f9f9f9; padding: 10px; border-radius: 12px; }
        .person-btn { border: 1px solid #ddd; background: white; padding: 5px 12px; border-radius: 8px; font-weight: bold; }

        /* –ö–æ—Ä–∑–∏–Ω–∞ */
        .cart-item { background: white; padding: 12px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--main); }
        .total-box { background: var(--main); color: white; padding: 20px; border-radius: 20px; text-align: center; margin-bottom: 20px; }

        .nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; height: 70px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .nav-btn { flex: 1; border: none; background: none; font-size: 12px; color: #b2bec3; font-weight: 600; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; }
        .nav-btn.active-tab { color: var(--main); }
        .btn-add { background: var(--main); color: white; border: none; padding: 12px; border-radius: 12px; width: 100%; font-weight: bold; font-size: 16px; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="header">
        <h2 style="margin:0; font-size: 20px; color: var(--main);">Project Food</h2>
        <span id="header-status" style="font-size: 12px; color: #999;">‚óè Online</span>
    </div>

    <div id="menu-page" class="page active">
        <div id="recipes-container"></div>
    </div>

    <div id="cart-page" class="page">
        <div class="total-box">
            <div style="opacity: 0.8; font-size: 13px;">–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï</div>
            <div style="font-size: 32px; font-weight: 800;"><span id="total-price">0</span> ‚ÇΩ</div>
        </div>
        <div id="cart-items"></div>
        <button class="btn-add" style="background:#ff7675;" onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
    </div>

    <nav class="nav">
        <button class="nav-btn active-tab" id="n-menu" onclick="showPage('menu')">üè† –ú–µ–Ω—é</button>
        <button class="nav-btn" id="n-cart" onclick="showPage('cart')">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>
    </nav>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCg0lFoxG721_P8tlf2fJsHiC7NsoE_EWM",
        authDomain: "foodproject-4aaf3.firebaseapp.com",
        databaseURL: "https://foodproject-4aaf3-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "foodproject-4aaf3",
        storageBucket: "foodproject-4aaf3.firebasestorage.app",
        messagingSenderId: "9549297996",
        appId: "1:9549297996:web:53af7c7e62317143c177e9"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // –ë–ê–ó–ê –î–ê–ù–ù–´–• –†–ï–¶–ï–ü–¢–û–í
    const recipes = [
        {
            id: 1,
            name: "–ë–æ—Ä—â –î–æ–º–∞—à–Ω–∏–π",
            kcal: 350,
            weight: 400, // –≥—Ä–∞–º–º –Ω–∞ –ø–æ—Ä—Ü–∏—é
            basePrice: 280, // —Ü–µ–Ω–∞ –Ω–∞ 1 —á–µ–ª–æ–≤–µ–∫–∞
            ingredients: [
                { n: "–ì–æ–≤—è–¥–∏–Ω–∞", q: 150, u: "–≥", p: 180 },
                { n: "–°–≤–µ–∫–ª–∞/–û–≤–æ—â–∏", q: 200, u: "–≥", p: 60 },
                { n: "–°–º–µ—Ç–∞–Ω–∞", q: 30, u: "–≥", p: 40 }
            ]
        },
        {
            id: 2,
            name: "–ü–∞—Å—Ç–∞ –ö–∞—Ä–±–æ–Ω–∞—Ä–∞",
            kcal: 620,
            weight: 350,
            basePrice: 420,
            ingredients: [
                { n: "–°–ø–∞–≥–µ—Ç—Ç–∏", q: 120, u: "–≥", p: 80 },
                { n: "–ë–µ–∫–æ–Ω", q: 80, u: "–≥", p: 150 },
                { n: "–°—ã—Ä –ü–∞—Ä–º–µ–∑–∞–Ω", q: 40, u: "–≥", p: 140 },
                { n: "–Ø–π—Ü–æ", q: 1, u: "—à—Ç", p: 50 }
            ]
        },
        {
            id: 3,
            name: "–°—Ç–µ–π–∫ –∏–∑ –ª–æ—Å–æ—Å—è",
            kcal: 450,
            weight: 300,
            basePrice: 950,
            ingredients: [
                { n: "–õ–æ—Å–æ—Å—å —Ñ–∏–ª–µ", q: 200, u: "–≥", p: 850 },
                { n: "–õ–∏–º–æ–Ω –∏ –∑–µ–ª–µ–Ω—å", q: 50, u: "–≥", p: 100 }
            ]
        }
    ];

    let selectedPersons = {}; // —Ö—Ä–∞–Ω–∏–º –∫–æ–ª-–≤–æ –ø–µ—Ä—Å–æ–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞

    function renderMenu() {
        const container = document.getElementById('recipes-container');
        container.innerHTML = recipes.map(r => {
            const p = selectedPersons[r.id] || 2;
            return `
            <div class="recipe-card">
                <div class="recipe-content">
                    <h3 style="margin:0">${r.name}</h3>
                    <div class="recipe-meta">
                        <span class="meta-item">üî• ${r.kcal * p} –∫–∫–∞–ª</span>
                        <span class="meta-item">‚öñÔ∏è ${r.weight * p} –≥</span>
                    </div>
                    
                    <div class="person-selector">
                        <span>–ü–µ—Ä—Å–æ–Ω—ã:</span>
                        <button class="person-btn" onclick="changeP(${r.id}, -2)">-</button>
                        <b style="min-width:20px; text-align:center">${p}</b>
                        <button class="person-btn" onclick="changeP(${r.id}, 2)">+</button>
                        <span style="margin-left:auto; font-weight:800; color:var(--main)">${r.basePrice * p} ‚ÇΩ</span>
                    </div>

                    <button class="btn-add" onclick="addToCloud(${r.id})">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
                </div>
            </div>`;
        }).join('');
    }

    function changeP(id, delta) {
        let current = selectedPersons[id] || 2;
        let next = current + delta;
        if (next > 0 && next <= 10) {
            selectedPersons[id] = next;
            renderMenu();
        }
    }

    function addToCloud(id) {
        const r = recipes.find(x => x.id === id);
        const p = selectedPersons[id] || 2;
        
        r.ingredients.forEach(ing => {
            db.ref("cart").push({
                name: ing.n,
                amount: ing.q * p,
                unit: ing.u,
                price: ing.p * p,
                dish: r.name
            });
        });
        alert("–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–∞ " + p + " —á–µ–ª. –¥–æ–±–∞–≤–ª–µ–Ω—ã!");
    }

    db.ref("cart").on("value", (snap) => {
        const data = snap.val();
        const container = document.getElementById('cart-items');
        const totalDisp = document.getElementById('total-price');
        let total = 0;
        container.innerHTML = "";

        if (!data) {
            container.innerHTML = "<p style='text-align:center; color:#999;'>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>";
            totalDisp.innerText = "0";
            return;
        }

        for (let key in data) {
            const item = data[key];
            total += item.price;
            container.innerHTML += `
                <div class="cart-item">
                    <div>
                        <div style="font-weight:bold">${item.name}</div>
                        <div style="font-size:11px; color:#999">${item.dish} | ${item.amount} ${item.unit}</div>
                    </div>
                    <div style="font-weight:bold">${item.price} ‚ÇΩ</div>
                </div>`;
        }
        totalDisp.innerText = total.toLocaleString();
    });

    function showPage(p) {
        document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active-tab'));
        document.getElementById(p + '-page').classList.add('active');
        document.getElementById('n-' + p).classList.add('active-tab');
    }

    function clearCart() { if(confirm("–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?")) db.ref("cart").remove(); }

    renderMenu();
</script>
</body>
</html>
