<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Food: FIXED</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #f0f4f4; display: flex; justify-content: center; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 20px; width: 100%; max-width: 400px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        select { width: 100%; padding: 15px; border-radius: 10px; border: 2px solid #eee; margin: 20px 0; }
        .res { display: none; text-align: left; background: #e0f2f1; padding: 15px; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="card">
        <h2 style="color:#46b8bc">üõí Project Food</h2>
        <select id="s"><option>–ó–∞–≥—Ä—É–∑–∫–∞...</option></select>
        <div id="r" class="res">
            <p><b>–í–µ—Å:</b> <span id="w"></span></p>
            <div id="i"></div>
        </div>
        <p id="err" style="color:red; font-size:12px; margin-top:10px"></p>
    </div>

<script>
    const U = 'https://lmchwsdguarvdigfqxku.supabase.co';
    const K = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtY2h3c2RndWFydmRpZ2ZxeGt1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzczMzI5NzUsImV4cCI6MjA1Mjk0ODk3NX0.3-vG_YF-L3kX-eBv-V-v-v-v-v-v-v-v-v-v-v-v';
    
    // –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç —Å —è–≤–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    const supabaseClient = supabase.createClient(U, K, {
        auth: { persistSession: false }
    });

    async function main() {
        try {
            const { data, error } = await supabaseClient.from('recipes').select('*');
            if (error) throw error;

            const sel = document.getElementById('s');
            if (!data || data.length === 0) {
                sel.innerHTML = '<option>–ë–∞–∑–∞ –ø—É—Å—Ç–∞</option>';
                return;
            }

            sel.innerHTML = '<option value="" selected disabled>–í—ã–±—Ä–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç</option>';
            data.forEach(x => {
                const o = document.createElement('option');
                o.value = x.id; o.textContent = x.title;
                sel.appendChild(o);
            });

            sel.onchange = (e) => {
                const item = data.find(x => x.id == e.target.value);
                document.getElementById('r').style.display = 'block';
                document.getElementById('w').textContent = item.total_weight;
                const ings = typeof item.ingredients === 'string' ? JSON.parse(item.ingredients) : item.ingredients;
                document.getElementById('i').innerHTML = ings.map(n => `<div>‚Ä¢ ${n.n}: ${n.w}</div>`).join('');
            };
        } catch (e) {
            document.getElementById('err').textContent = "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏. –ü–æ–ø—Ä–æ–±—É–π –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.";
            console.error(e);
        }
    }
    main();
</script>
</body>
</html>
