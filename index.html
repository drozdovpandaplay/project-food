<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Project Food: Final Fix</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --main: #46b8bc; --bg: #f4f7f6; --dark: #2d3436; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; color: var(--dark); }
        .header { background: #fff; padding: 15px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .search-box { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #eee; font-size: 16px; box-sizing: border-box; outline: none; }
        .recipe-card { background: #fff; margin: 15px; padding: 18px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); cursor: pointer; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 1000; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .modal.active { display: block; }
        .step-item { display: flex; gap: 10px; margin-bottom: 12px; align-items: flex-start; }
        .step-num { background: var(--main); color: #fff; width: 24px; height: 24px; border-radius: 50%; text-align: center; font-size: 12px; line-height: 24px; flex-shrink: 0; font-weight: bold; }
        .nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: #fff; display: flex; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .nav-btn { flex: 1; border: none; background: none; font-weight: bold; color: #ccc; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; font-size: 12px; }
        .nav-btn.active { color: var(--main); }
        .btn { background: var(--main); color: #fff; border: none; padding: 16px; border-radius: 14px; width: 100%; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="header" id="header-ui">
        <input type="text" id="searchInput" class="search-box" placeholder="üîç –ü–æ–∏—Å–∫ —Ä–µ—Ü–µ–ø—Ç–∞ –∏–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–∞..." oninput="render()">
    </div>

    <div id="menu-page" class="page active">
        <div id="recipes-list"></div>
    </div>

    <div id="cart-page" class="page" style="display:none; padding:15px;">
        <h2 style="margin-top:0;">üõí –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h2>
        <div id="cart-content"></div>
        <button class="btn" style="background:#ff7675;" onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>

    <div id="recipe-modal" class="modal">
        <button onclick="closeRecipe()" style="border:none; background:#f0f0f0; padding:10px 20px; border-radius:10px; margin-bottom:15px; font-weight:bold;">‚Üê –ù–∞–∑–∞–¥</button>
        <div id="modal-data"></div>
    </div>

    <nav class="nav">
        <button class="nav-btn active" id="b-menu" onclick="showPage('menu')">üè† <span>–ú–µ–Ω—é</span></button>
        <button class="nav-btn" id="b-cart" onclick="showPage('cart')">üõí <span>–ö–æ—Ä–∑–∏–Ω–∞</span></button>
    </nav>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCg0lFoxG721_P8tlf2fJsHiC7NsoE_EWM",
        authDomain: "foodproject-4aaf3.firebaseapp.com",
        databaseURL: "https://foodproject-4aaf3-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "foodproject-4aaf3",
        storageBucket: "foodproject-4aaf3.firebasestorage.app",
        messagingSenderId: "9549297996",
        appId: "1:9549297996:web:53af7c7e62317143c177e9"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (10 —Ä–µ—Ü–µ–ø—Ç–æ–≤)
    const defaultRecipes = [
        { name: "–ë–æ—Ä—â –î–æ–º–∞—à–Ω–∏–π", kcal: 350, weight: 400, ings: ["–ì–æ–≤—è–¥–∏–Ω–∞", "–°–≤–µ–∫–ª–∞", "–ö–∞–ø—É—Å—Ç–∞", "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å"], steps: ["–°–≤–∞—Ä–∏—Ç—å –º—è—Å–Ω–æ–π –±—É–ª—å–æ–Ω (1.5 —á–∞—Å–∞).", "–°–¥–µ–ª–∞—Ç—å –∑–∞–∂–∞—Ä–∫—É –∏–∑ —Å–≤–µ–∫–ª—ã –∏ –º–æ—Ä–∫–æ–≤–∏.", "–î–æ–±–∞–≤–∏—Ç—å –æ–≤–æ—â–∏ –≤ –±—É–ª—å–æ–Ω –∏ –≤–∞—Ä–∏—Ç—å 20 –º–∏–Ω—É—Ç."] },
        { name: "–û–≤—Å—è–Ω–∫–∞ —Å —è–≥–æ–¥–∞–º–∏", kcal: 220, weight: 250, ings: ["–û–≤—Å—è–Ω—ã–µ —Ö–ª–æ–ø—å—è", "–ú–æ–ª–æ–∫–æ", "–ú–µ–¥", "–ì–æ–ª—É–±–∏–∫–∞"], steps: ["–í—Å–∫–∏–ø—è—Ç–∏—Ç—å –º–æ–ª–æ–∫–æ.", "–í—Å—ã–ø–∞—Ç—å —Ö–ª–æ–ø—å—è –∏ –≤–∞—Ä–∏—Ç—å 5 –º–∏–Ω—É—Ç.", "–î–æ–±–∞–≤–∏—Ç—å –º–µ–¥ –∏ —è–≥–æ–¥—ã."] },
        { name: "–ü–∞—Å—Ç–∞ –ö–∞—Ä–±–æ–Ω–∞—Ä–∞", kcal: 600, weight: 350, ings: ["–°–ø–∞–≥–µ—Ç—Ç–∏", "–ë–µ–∫–æ–Ω", "–Ø–π—Ü–æ", "–°—ã—Ä –ü–∞—Ä–º–µ–∑–∞–Ω"], steps: ["–û—Ç–≤–∞—Ä–∏—Ç—å –ø–∞—Å—Ç—É 8 –º–∏–Ω—É—Ç.", "–û–±–∂–∞—Ä–∏—Ç—å –±–µ–∫–æ–Ω.", "–°–º–µ—à–∞—Ç—å –≥–æ—Ä—è—á—É—é –ø–∞—Å—Ç—É —Å —è–π—Ü–æ–º –∏ —Å—ã—Ä–æ–º."] },
        { name: "–°–∞–ª–∞—Ç –¶–µ–∑–∞—Ä—å", kcal: 450, weight: 300, ings: ["–ö—É—Ä–∏–Ω–æ–µ —Ñ–∏–ª–µ", "–°–∞–ª–∞—Ç –†–æ–º–∞–Ω–æ", "–°—É—Ö–∞—Ä–∏–∫–∏", "–°–æ—É—Å –¶–µ–∑–∞—Ä—å"], steps: ["–û–±–∂–∞—Ä–∏—Ç—å –∫—É—Ä–∏—Ü—É.", "–ù–∞—Ä–µ–∑–∞—Ç—å —Å–∞–ª–∞—Ç.", "–°–º–µ—à–∞—Ç—å –≤—Å–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –∏ –∑–∞–ø—Ä–∞–≤–∏—Ç—å."] },
        { name: "–û–º–ª–µ—Ç —Å —Å—ã—Ä–æ–º", kcal: 300, weight: 200, ings: ["–Ø–π—Ü–∞ (3 —à—Ç)", "–ú–æ–ª–æ–∫–æ", "–°—ã—Ä", "–ó–µ–ª–µ–Ω—å"], steps: ["–í–∑–±–∏—Ç—å —è–π—Ü–∞ —Å –º–æ–ª–æ–∫–æ–º.", "–í—ã–ª–∏—Ç—å –Ω–∞ —Å–∫–æ–≤–æ—Ä–æ–¥—É.", "–ü–æ—Å—ã–ø–∞—Ç—å —Å—ã—Ä–æ–º –∏ –≥–æ—Ç–æ–≤–∏—Ç—å –ø–æ–¥ –∫—Ä—ã—à–∫–æ–π 4 –º–∏–Ω—É—Ç—ã."] },
        { name: "–ü–ª–æ–≤ —Å –≥–æ–≤—è–¥–∏–Ω–æ–π", kcal: 550, weight: 400, ings: ["–†–∏—Å", "–ì–æ–≤—è–¥–∏–Ω–∞", "–ú–æ—Ä–∫–æ–≤—å", "–õ—É–∫"], steps: ["–û–±–∂–∞—Ä–∏—Ç—å –º—è—Å–æ —Å –æ–≤–æ—â–∞–º–∏ (–∑–∏—Ä–≤–∞–∫).", "–ó–∞—Å—ã–ø–∞—Ç—å —Ä–∏—Å –∏ –∑–∞–ª–∏—Ç—å –≤–æ–¥–æ–π.", "–¢–æ–º–∏—Ç—å –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–º –æ–≥–Ω–µ 30 –º–∏–Ω—É—Ç."] },
        { name: "–ö—É—Ä–∏–Ω—ã–π —Å—É–ø", kcal: 250, weight: 400, ings: ["–ö—É—Ä–∏—Ü–∞", "–õ–∞–ø—à–∞", "–ú–æ—Ä–∫–æ–≤—å", "–ó–µ–ª–µ–Ω—å"], steps: ["–°–≤–∞—Ä–∏—Ç—å –∫—É—Ä–∏—Ü—É.", "–î–æ–±–∞–≤–∏—Ç—å –æ–≤–æ—â–∏ –∏ –ª–∞–ø—à—É.", "–í–∞—Ä–∏—Ç—å –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ª–∞–ø—à–∏ (7 –º–∏–Ω—É—Ç)."] },
        { name: "–°—Ç–µ–π–∫ –∏–∑ –ª–æ—Å–æ—Å—è", kcal: 400, weight: 250, ings: ["–õ–æ—Å–æ—Å—å", "–õ–∏–º–æ–Ω", "–°–ø–µ—Ü–∏–∏", "–†–æ–∑–º–∞—Ä–∏–Ω"], steps: ["–ó–∞–º–∞—Ä–∏–Ω–æ–≤–∞—Ç—å —Ä—ã–±—É –≤ –ª–∏–º–æ–Ω–µ.", "–û–±–∂–∞—Ä–∏—Ç—å –ø–æ 4 –º–∏–Ω—É—Ç—ã —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã.", "–ü–æ–¥–∞–≤–∞—Ç—å —Å —Ä–æ–∑–º–∞—Ä–∏–Ω–æ–º."] },
        { name: "–ì—Ä–µ—á–µ—Å–∫–∏–π —Å–∞–ª–∞—Ç", kcal: 200, weight: 250, ings: ["–¢–æ–º–∞—Ç—ã", "–û–≥—É—Ä—Ü—ã", "–§–µ—Ç–∞", "–û–ª–∏–≤–∫–∏"], steps: ["–ö—Ä—É–ø–Ω–æ –Ω–∞—Ä–µ–∑–∞—Ç—å –æ–≤–æ—â–∏.", "–î–æ–±–∞–≤–∏—Ç—å —Å—ã—Ä –∏ –æ–ª–∏–≤–∫–∏.", "–ó–∞–ø—Ä–∞–≤–∏—Ç—å –æ–ª–∏–≤–∫–æ–≤—ã–º –º–∞—Å–ª–æ–º."] },
        { name: "–ë–ª–∏–Ω—ã", kcal: 380, weight: 200, ings: ["–ú—É–∫–∞", "–Ø–π—Ü–∞", "–ú–æ–ª–æ–∫–æ", "–°–∞—Ö–∞—Ä"], steps: ["–°–º–µ—à–∞—Ç—å —Ç–µ—Å—Ç–æ –±–µ–∑ –∫–æ–º–æ—á–∫–æ–≤.", "–í—ã–ø–µ–∫–∞—Ç—å –Ω–∞ —Ä–∞—Å–∫–∞–ª–µ–Ω–Ω–æ–π —Å–∫–æ–≤–æ—Ä–æ–¥–µ.", "–ü–æ–¥–∞–≤–∞—Ç—å —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π –∏–ª–∏ –¥–∂–µ–º–æ–º."] }
    ];

    let currentRecipes = [];

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    function init() {
        db.ref("recipes").on("value", (snap) => {
            const data = snap.val();
            if (!data) {
                // –ï—Å–ª–∏ –≤ –æ–±–ª–∞–∫–µ –ø—É—Å—Ç–æ - –∑–∞–≥—Ä—É–∂–∞–µ–º 10 —Ä–µ—Ü–µ–ø—Ç–æ–≤
                defaultRecipes.forEach(r => db.ref("recipes").push(r));
            } else {
                currentRecipes = Object.keys(data).map(key => ({...data[key], fireRef: key}));
                render();
            }
        });
    }

    function render() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const list = document.getElementById('recipes-list');
        list.innerHTML = currentRecipes
            .filter(r => r.name.toLowerCase().includes(q) || (r.ings && r.ings.join(' ').toLowerCase().includes(q)))
            .map(r => `
                <div class="recipe-card" onclick="openRecipe('${r.fireRef}')">
                    <h3 style="margin:0; color:var(--main);">${r.name}</h3>
                    <div style="margin-top:8px; font-size:13px; color:#666;">
                        üî• ${r.kcal || 0} –∫–∫–∞–ª | ‚öñÔ∏è ${r.weight || 0} –≥
                    </div>
                </div>
            `).join('');
    }

    function openRecipe(ref) {
        const r = currentRecipes.find(x => x.fireRef === ref);
        const modal = document.getElementById('recipe-modal');
        document.getElementById('modal-data').innerHTML = `
            <h1 style="margin:0 0 10px 0;">${r.name}</h1>
            <div style="background:#f9f9f9; padding:15px; border-radius:15px; margin-bottom:20px;">
                <b style="display:block; margin-bottom:5px;">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</b>
                <div style="line-height:1.6; color:#444;">${r.ings ? r.ings.join(' ‚Ä¢ ') : '–ù–µ —É–∫–∞–∑–∞–Ω—ã'}</div>
            </div>
            <h3>–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:</h3>
            ${r.steps ? r.steps.map((s, i) => `
                <div class="step-item">
                    <div class="step-num">${i+1}</div>
                    <div style="line-height:1.4;">${s}</div>
                </div>
            `).join('') : '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è'}
            <button class="btn" onclick="addToCart('${ref}')">üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
        `;
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeRecipe() {
        document.getElementById('recipe-modal').classList.remove('active');
        document.body.style.overflow = 'auto';
    }

    function addToCart(ref) {
        const r = currentRecipes.find(x => x.fireRef === ref);
        if(r.ings) {
            r.ings.forEach(ing => db.ref("cart").push({ name: ing, dish: r.name }));
            alert("–í—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã –¥–ª—è '" + r.name + "' –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–æ—Ä–∑–∏–Ω—É!");
        }
    }

    // –°–ª—É—à–∞—Ç–µ–ª—å –∫–æ—Ä–∑–∏–Ω—ã
    db.ref("cart").on("value", (snap) => {
        const data = snap.val();
        const cont = document.getElementById('cart-content');
        cont.innerHTML = "";
        if(!data) { cont.innerHTML = "<p style='color:#999; text-align:center;'>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>"; return; }
        for(let k in data) {
            cont.innerHTML += `
                <div style="background:#fff; padding:12px; border-radius:10px; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 5px rgba(0,0,0,0.03);">
                    <span><b>${data[k].name}</b></span>
                    <small style="color:#999;">${data[k].dish}</small>
                </div>`;
        }
    });

    function showPage(p) {
        document.getElementById('menu-page').style.display = (p === 'menu' ? 'block' : 'none');
        document.getElementById('cart-page').style.display = (p === 'cart' ? 'block' : 'none');
        document.getElementById('header-ui').style.display = (p === 'menu' ? 'block' : 'none');
        document.getElementById('b-menu').classList.toggle('active', p === 'menu');
        document.getElementById('b-cart').classList.toggle('active', p === 'cart');
        closeRecipe();
    }

    function clearCart() { if(confirm("–û—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫?")) db.ref("cart").remove(); }

    init();
</script>
</body>
</html>
