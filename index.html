<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Project Food: Ultimate</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --main: #46b8bc; --bg: #f4f7f6; --dark: #2d3436; --white: #ffffff; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; color: var(--dark); }
        
        .header { background: var(--white); padding: 15px 15px 5px 15px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        
        /* –ü–æ–∏—Å–∫ */
        .search-box { width: 100%; padding: 12px 15px; border-radius: 12px; border: 1px solid #eee; background: #f9f9f9; box-sizing: border-box; font-size: 16px; margin-bottom: 10px; outline: none; }
        .search-box:focus { border-color: var(--main); background: #fff; }

        .filter-row { display: flex; overflow-x: auto; gap: 8px; padding: 5px 0 10px 0; scrollbar-width: none; }
        .filter-row::-webkit-scrollbar { display: none; }
        .filter-btn { background: #eee; border: none; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; white-space: nowrap; cursor: pointer; color: #777; }
        .filter-btn.active { background: var(--main); color: white; }

        .page { display: none; padding: 15px; }
        .active { display: block; }

        .recipe-card { background: var(--white); border-radius: 22px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); padding: 18px; border: 1px solid #f0f0f0; }
        .category-tag { font-size: 10px; text-transform: uppercase; color: var(--main); font-weight: 800; letter-spacing: 0.5px; }
        
        .recipe-meta { display: flex; gap: 8px; margin: 10px 0; font-size: 11px; font-weight: 600; }
        .meta-item { background: #f0f3f2; padding: 4px 10px; border-radius: 12px; color: #636e72; }
        
        .person-selector { display: flex; align-items: center; gap: 12px; margin: 15px 0; background: #f9f9f9; padding: 10px; border-radius: 15px; }
        .person-btn { border: none; background: var(--main); color: white; width: 32px; height: 32px; border-radius: 10px; font-size: 18px; cursor: pointer; }

        .cart-item { background: var(--white); padding: 15px; border-radius: 18px; margin-bottom: 10px; display: flex; align-items: center; border-left: 5px solid var(--main); transition: 0.2s; cursor: pointer; }
        .cart-item.checked { opacity: 0.5; border-left-color: #bdc3c7; }
        .cart-item.checked .item-name { text-decoration: line-through; }
        
        .checkbox { width: 22px; height: 22px; border: 2px solid var(--main); border-radius: 7px; margin-right: 15px; flex-shrink: 0; position: relative; }
        .cart-item.checked .checkbox { background: var(--main); }
        .cart-item.checked .checkbox::after { content: '‚úì'; color: white; position: absolute; left: 4px; top: -1px; font-weight: bold; }

        .total-box { background: var(--main); color: var(--white); padding: 25px; border-radius: 25px; text-align: center; margin-bottom: 25px; }

        .nav { position: fixed; bottom: 0; width: 100%; background: var(--white); display: flex; height: 75px; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); }
        .nav-btn { flex: 1; border: none; background: none; font-size: 12px; color: #b2bec3; font-weight: bold; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .nav-btn.active-tab { color: var(--main); }
        
        .btn-add { background: var(--main); color: var(--white); border: none; padding: 16px; border-radius: 16px; width: 100%; font-weight: 800; cursor: pointer; font-size: 15px; }
    </style>
</head>
<body>

    <div class="header" id="main-header">
        <input type="text" id="searchInput" class="search-box" placeholder="üîç –ü–æ–∏—Å–∫ –±–ª—é–¥–∞ –∏–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–∞..." oninput="renderMenu()">
        <div class="filter-row">
            <button class="filter-btn active" onclick="filterBy('All', this)">–í—Å–µ</button>
            <button class="filter-btn" onclick="filterBy('–ó–∞–≤—Ç—Ä–∞–∫', this)">–ó–∞–≤—Ç—Ä–∞–∫–∏</button>
            <button class="filter-btn" onclick="filterBy('–û–±–µ–¥', this)">–û–±–µ–¥—ã</button>
            <button class="filter-btn" onclick="filterBy('–£–∂–∏–Ω', this)">–£–∂–∏–Ω—ã</button>
            <button class="filter-btn" onclick="filterBy('Light', this)">üçÄ < 400 –∫–∫–∞–ª</button>
        </div>
    </div>

    <div id="menu-page" class="page active">
        <div id="recipes-container"></div>
    </div>

    <div id="cart-page" class="page">
        <div class="total-box">
            <div style="opacity: 0.8; font-size: 12px; margin-bottom: 5px; letter-spacing: 1px;">–û–ë–©–ò–ô –ë–Æ–î–ñ–ï–¢</div>
            <div style="font-size: 36px; font-weight: 900;"><span id="total-price">0</span> ‚ÇΩ</div>
        </div>
        <div id="cart-items"></div>
        <button class="btn-add" style="background:#ff7675; margin-top:20px;" onclick="clearCart()">–û–ß–ò–°–¢–ò–¢–¨ –ö–û–†–ó–ò–ù–£</button>
    </div>

    <nav class="nav">
        <button class="nav-btn active-tab" id="n-menu" onclick="showPage('menu')">üè† –ú–µ–Ω—é</button>
        <button class="nav-btn" id="n-cart" onclick="showPage('cart')">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>
    </nav>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCg0lFoxG721_P8tlf2fJsHiC7NsoE_EWM",
        authDomain: "foodproject-4aaf3.firebaseapp.com",
        databaseURL: "https://foodproject-4aaf3-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "foodproject-4aaf3",
        storageBucket: "foodproject-4aaf3.firebasestorage.app",
        messagingSenderId: "9549297996",
        appId: "1:9549297996:web:53af7c7e62317143c177e9"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const recipes = [
        { id: 1, cat: "–ó–∞–≤—Ç—Ä–∞–∫", name: "–û–≤—Å—è–Ω–∫–∞ —Å —è–≥–æ–¥–∞–º–∏", kcal: 320, weight: 300, basePrice: 150, ings: [{n: "–û–≤—Å—è–Ω–∫–∞", q: 100, u: "–≥", p: 40}, {n: "–Ø–≥–æ–¥—ã", q: 50, u: "–≥", p: 80}, {n: "–ú–æ–ª–æ–∫–æ", q: 150, u: "–º–ª", p: 30}] },
        { id: 2, cat: "–ó–∞–≤—Ç—Ä–∞–∫", name: "–°—ã—Ä–Ω–∏–∫–∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ", kcal: 450, weight: 250, basePrice: 280, ings: [{n: "–¢–≤–æ—Ä–æ–≥", q: 200, u: "–≥", p: 180}, {n: "–Ø–π—Ü–æ", q: 1, u: "—à—Ç", p: 15}, {n: "–ú—É–∫–∞", q: 40, u: "–≥", p: 85}] },
        { id: 3, cat: "–û–±–µ–¥", name: "–ë–æ—Ä—â –î–æ–º–∞—à–Ω–∏–π", kcal: 380, weight: 400, basePrice: 320, ings: [{n: "–ì–æ–≤—è–¥–∏–Ω–∞", q: 150, u: "–≥", p: 200}, {n: "–û–≤–æ—â–∏", q: 200, u: "–≥", p: 80}, {n: "–°–º–µ—Ç–∞–Ω–∞", q: 30, u: "–≥", p: 40}] },
        { id: 4, cat: "–û–±–µ–¥", name: "–ö—É—Ä–∏–Ω—ã–π —Å—É–ø-–ª–∞–ø—à–∞", kcal: 290, weight: 400, basePrice: 220, ings: [{n: "–ö—É—Ä–∏—Ü–∞", q: 120, u: "–≥", p: 130}, {n: "–õ–∞–ø—à–∞", q: 50, u: "–≥", p: 40}, {n: "–ó–µ–ª–µ–Ω—å", q: 50, u: "–≥", p: 50}] },
        { id: 5, cat: "–£–∂–∏–Ω", name: "–ü–∞—Å—Ç–∞ –ö–∞—Ä–±–æ–Ω–∞—Ä–∞", kcal: 650, weight: 350, basePrice: 450, ings: [{n: "–°–ø–∞–≥–µ—Ç—Ç–∏", q: 120, u: "–≥", p: 90}, {n: "–ë–µ–∫–æ–Ω", q: 80, u: "–≥", p: 160}, {n: "–ü–∞—Ä–º–µ–∑–∞–Ω", q: 40, u: "–≥", p: 200}] },
        { id: 6, cat: "–£–∂–∏–Ω", name: "–ö—É—Ä–∏—Ü–∞ –¢–µ—Ä–∏—è–∫–∏", kcal: 520, weight: 400, basePrice: 380, ings: [{n: "–ö—É—Ä–∏—Ü–∞", q: 180, u: "–≥", p: 180}, {n: "–†–∏—Å", q: 150, u: "–≥", p: 80}, {n: "–°–æ—É—Å", q: 40, u: "–≥", p: 120}] },
        { id: 7, cat: "–°–∞–ª–∞—Ç", name: "–ì—Ä–µ—á–µ—Å–∫–∏–π —Å–∞–ª–∞—Ç", kcal: 210, weight: 250, basePrice: 350, ings: [{n: "–°—ã—Ä –§–µ—Ç–∞", q: 60, u: "–≥", p: 150}, {n: "–û–≤–æ—â–∏", q: 150, u: "–≥", p: 120}, {n: "–ú–∞—Å–ª–æ", q: 30, u: "–≥", p: 80}] },
        { id: 8, cat: "–£–∂–∏–Ω", name: "–°—Ç–µ–π–∫ –∏–∑ –õ–æ—Å–æ—Å—è", kcal: 480, weight: 300, basePrice: 980, ings: [{n: "–õ–æ—Å–æ—Å—å", q: 200, u: "–≥", p: 850}, {n: "–ì–∞—Ä–Ω–∏—Ä", q: 100, u: "–≥", p: 130}] },
        { id: 9, cat: "–û–±–µ–¥", name: "–°—É–ø –ß–µ—á–µ–≤–∏—á–Ω—ã–π", kcal: 310, weight: 350, basePrice: 190, ings: [{n: "–ß–µ—á–µ–≤–∏—Ü–∞", q: 100, u: "–≥", p: 70}, {n: "–û–≤–æ—â–∏", q: 250, u: "–≥", p: 120}] },
        { id: 10, cat: "–ó–∞–≤—Ç—Ä–∞–∫", name: "–°–∫—Ä–µ–º–±–ª —Å –ê–≤–æ–∫–∞–¥–æ", kcal: 410, weight: 280, basePrice: 420, ings: [{n: "–Ø–π—Ü–∞", q: 3, u: "—à—Ç", p: 45}, {n: "–ê–≤–æ–∫–∞–¥–æ", q: 1, u: "—à—Ç", p: 150}, {n: "–•–ª–µ–±", q: 2, u: "–∫—É—Å", p: 225}] }
    ];

    let currentFilter = 'All';
    let selectedPersons = {};

    function filterBy(type, btn) {
        currentFilter = type;
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderMenu();
    }

    function renderMenu() {
        const container = document.getElementById('recipes-container');
        const query = document.getElementById('searchInput').value.toLowerCase();
        
        let filtered = recipes.filter(r => {
            const matchesSearch = r.name.toLowerCase().includes(query) || 
                                 r.ings.some(ing => ing.n.toLowerCase().includes(query));
            const matchesFilter = (currentFilter === 'All') || 
                                 (currentFilter === 'Light' && r.kcal <= 400) || 
                                 (r.cat === currentFilter);
            return matchesSearch && matchesFilter;
        });

        container.innerHTML = filtered.map(r => {
            const p = selectedPersons[r.id] || 2;
            return `
            <div class="recipe-card">
                <div class="category-tag">${r.cat}</div>
                <h3 style="margin:5px 0 0 0;">${r.name}</h3>
                <div class="recipe-meta">
                    <span class="meta-item">üî• ${r.kcal * p} kcal</span>
                    <span class="meta-item">‚öñÔ∏è ${r.weight * p} –≥</span>
                </div>
                <div class="person-selector">
                    <button class="person-btn" onclick="changeP(${r.id}, -1)">-</button>
                    <b style="min-width:60px; text-align:center;">${p} —á–µ–ª</b>
                    <button class="person-btn" onclick="changeP(${r.id}, 1)">+</button>
                    <div style="margin-left:auto; font-weight:900; color:var(--main); font-size:18px;">${r.basePrice * p} ‚ÇΩ</div>
                </div>
                <button class="btn-add" onclick="addToCloud(${r.id})">–í–´–ë–†–ê–¢–¨ –ë–õ–Æ–î–û</button>
            </div>`;
        }).join('');
    }

    function changeP(id, delta) {
        let current = selectedPersons[id] || 2;
        let next = current + delta;
        if (next >= 1 && next <= 12) {
            selectedPersons[id] = next;
            renderMenu();
        }
    }

    function addToCloud(id) {
        const r = recipes.find(x => x.id === id);
        const p = selectedPersons[id] || 2;
        r.ings.forEach(ing => {
            db.ref("cart").push({ name: ing.n, amount: (ing.q * p).toFixed(1), unit: ing.u, price: ing.p * p, dish: r.name, checked: false });
        });
        alert("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É!");
    }

    function toggleItem(id, status) { db.ref("cart/" + id).update({ checked: !status }); }

    db.ref("cart").on("value", (snap) => {
        const data = snap.val();
        const container = document.getElementById('cart-items');
        const totalDisp = document.getElementById('total-price');
        let total = 0;
        container.innerHTML = "";
        if (!data) {
            container.innerHTML = "<div style='text-align:center; padding:40px; color:#b2bec3;'>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.</div>";
            totalDisp.innerText = "0";
            return;
        }
        for (let id in data) {
            const item = data[id];
            total += item.price;
            container.innerHTML += `
                <div class="cart-item ${item.checked ? 'checked' : ''}" onclick="toggleItem('${id}', ${item.checked})">
                    <div class="checkbox"></div>
                    <div style="flex-grow:1;">
                        <div class="item-name" style="font-weight:800; font-size:15px;">${item.name}</div>
                        <div style="font-size:11px; color:#999;">${item.dish} ‚Ä¢ ${item.amount} ${item.unit}</div>
                    </div>
                    <div style="font-weight:900; color:var(--main)">${item.price} ‚ÇΩ</div>
                </div>`;
        }
        totalDisp.innerText = total.toLocaleString();
    });

    function showPage(p) {
        document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active-tab'));
        document.getElementById(p + '-page').classList.add('active');
        document.getElementById('n-' + p).classList.add('active-tab');
        document.getElementById('main-header').style.display = (p === 'menu') ? 'block' : 'none';
        window.scrollTo(0,0);
    }

    function clearCart() { if(confirm("–û—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫?")) db.ref("cart").remove(); }
    renderMenu();
</script>
</body>
</html>
