<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Project Food: Final Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <style>
        :root { --main: #46b8bc; --bg: #f4f7f6; --dark: #2d3436; --white: #ffffff; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; color: var(--dark); overflow-x: hidden; }
        
        /* –®–∞–ø–∫–∞ —Å –ø–æ–∏—Å–∫–æ–º */
        .header { background: var(--white); padding: 15px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .search-box { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #eee; background: #f9f9f9; font-size: 16px; outline: none; transition: 0.3s; }
        .search-box:focus { border-color: var(--main); background: #fff; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü */
        .page { display: none; padding: 15px; }
        .active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –±–ª—é–¥ */
        .recipe-card { background: var(--white); border-radius: 22px; margin-bottom: 15px; padding: 18px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); cursor: pointer; border: 1px solid transparent; }
        .recipe-card:active { transform: scale(0.98); border-color: var(--main); }
        .category-tag { font-size: 10px; text-transform: uppercase; color: var(--main); font-weight: 800; margin-bottom: 5px; }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ—Ü–µ–ø—Ç–∞ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--white); z-index: 1000; overflow-y: auto; padding: 20px; box-sizing: border-box; }
        .modal.active { display: block; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .close-modal { background: #f0f3f2; border: none; padding: 12px; border-radius: 15px; font-weight: bold; width: 100%; text-align: left; margin-bottom: 20px; color: var(--main); }

        /* –¢–∞–π–º–µ—Ä –≤ —Ç–µ–∫—Å—Ç–µ */
        .timer-link { color: var(--main); text-decoration: underline; font-weight: bold; cursor: pointer; background: #e0f2f1; padding: 2px 6px; border-radius: 6px; }

        /* –°–ø–∏—Å–æ–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –∏ —à–∞–≥–∏ */
        .ing-line { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #eee; }
        .step-item { display: flex; gap: 12px; margin-bottom: 15px; }
        .step-num { background: var(--main); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; flex-shrink: 0; }

        /* –ö–æ—Ä–∑–∏–Ω–∞ */
        .cart-item { background: var(--white); padding: 15px; border-radius: 15px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--main); }
        .btn-add { background: var(--main); color: var(--white); border: none; padding: 16px; border-radius: 16px; width: 100%; font-weight: 800; cursor: pointer; margin-top: 15px; }

        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        .nav { position: fixed; bottom: 0; width: 100%; background: var(--white); display: flex; height: 75px; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); }
        .nav-btn { flex: 1; border: none; background: none; font-size: 11px; color: #b2bec3; font-weight: bold; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; }
        .nav-btn.active-tab { color: var(--main); }
    </style>
</head>
<body>

    <div class="header" id="main-header">
        <input type="text" id="searchInput" class="search-box" placeholder="üîç –ù–∞–π—Ç–∏ –±–ª—é–¥–æ –∏–ª–∏ –ø—Ä–æ–¥—É–∫—Ç..." oninput="renderMenu()">
    </div>

    <div id="menu-page" class="page active">
        <div id="recipes-container"></div>
    </div>

    <div id="cart-page" class="page">
        <h2 style="margin-top:0;">üõí –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h2>
        <div id="cart-items"></div>
        <button class="btn-add" style="background:#ff7675;" onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>

    <div id="recipe-modal" class="modal">
        <button class="close-modal" onclick="closeRecipe()">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</button>
        <div id="modal-content"></div>
    </div>

    <nav class="nav">
        <button class="nav-btn active-tab" id="n-menu" onclick="showPage('menu')">üè† –ú–µ–Ω—é</button>
        <button class="nav-btn" id="n-cart" onclick="showPage('cart')">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>
    </nav>

<script>
    // –¢–≤–æ–π –∫–æ–Ω—Ñ–∏–≥ Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyCg0lFoxG721_P8tlf2fJsHiC7NsoE_EWM",
        authDomain: "foodproject-4aaf3.firebaseapp.com",
        databaseURL: "https://foodproject-4aaf3-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "foodproject-4aaf3",
        storageBucket: "foodproject-4aaf3.firebasestorage.app",
        messagingSenderId: "9549297996",
        appId: "1:9549297996:web:53af7c7e62317143c177e9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤
    const recipes = [
        { 
            id: 1, cat: "–ó–∞–≤—Ç—Ä–∞–∫", name: "–û–≤—Å—è–Ω–∫–∞ —Å —è–≥–æ–¥–∞–º–∏", kcal: 320, weight: 300, 
            ings: [{n: "–û–≤—Å—è–Ω–∫–∞", q: 100, u: "–≥"}, {n: "–Ø–≥–æ–¥—ã", q: 50, u: "–≥"}, {n: "–ú–æ–ª–æ–∫–æ", q: 150, u: "–º–ª"}],
            steps: ["–í—Å–∫–∏–ø—è—Ç–∏—Ç–µ –º–æ–ª–æ–∫–æ.", "–í—Å—ã–ø—å—Ç–µ –æ–≤—Å—è–Ω–∫—É –∏ –≤–∞—Ä–∏—Ç–µ 5 –º–∏–Ω—É—Ç –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–º –æ–≥–Ω–µ.", "–î–æ–±–∞–≤—å—Ç–µ —è–≥–æ–¥—ã."]
        },
        { 
            id: 2, cat: "–£–∂–∏–Ω", name: "–ü–∞—Å—Ç–∞ –ö–∞—Ä–±–æ–Ω–∞—Ä–∞", kcal: 650, weight: 350, 
            ings: [{n: "–°–ø–∞–≥–µ—Ç—Ç–∏", q: 120, u: "–≥"}, {n: "–ë–µ–∫–æ–Ω", q: 80, u: "–≥"}, {n: "–ü–∞—Ä–º–µ–∑–∞–Ω", q: 40, u: "–≥"}],
            steps: ["–í–∞—Ä–∏—Ç–µ –ø–∞—Å—Ç—É 8 –º–∏–Ω—É—Ç –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏.", "–û–±–∂–∞—Ä—å—Ç–µ –±–µ–∫–æ–Ω.", "–°–º–µ—à–∞–π—Ç–µ –ø–∞—Å—Ç—É —Å —Å—ã—Ä–æ–º –∏ –±–µ–∫–æ–Ω–æ–º."]
        }
    ];

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –º–µ–Ω—é
    function renderMenu() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const container = document.getElementById('recipes-container');
        
        const filtered = recipes.filter(r => r.name.toLowerCase().includes(query) || 
            r.ings.some(i => i.n.toLowerCase().includes(query)));

        container.innerHTML = filtered.map(r => `
            <div class="recipe-card" onclick="openRecipe(${r.id})">
                <div class="category-tag">${r.cat}</div>
                <h3 style="margin:0;">${r.name}</h3>
                <div style="font-size:12px; color:#999; margin-top:5px;">${r.kcal} –∫–∫–∞–ª | ${r.weight} –≥</div>
            </div>
        `).join('');
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞
    function openRecipe(id) {
        const r = recipes.find(x => x.id === id);
        const content = document.getElementById('modal-content');
        
        const stepsHtml = r.steps.map((step, i) => {
            const stepWithTimer = step.replace(/(\d+)\s+–º–∏–Ω—É—Ç/g, (match, p1) => 
                `<span class="timer-link" onclick="event.stopPropagation(); startTimer(${p1}, '${r.name}')">${match} ‚è±Ô∏è</span>`
            );
            return `<div class="step-item"><div class="step-num">${i+1}</div><div class="step-text">${stepWithTimer}</div></div>`;
        }).join('');

        content.innerHTML = `
            <h1>${r.name}</h1>
            <h3>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</h3>
            ${r.ings.map(i => `<div class="ing-line"><span>${i.n}</span><b>${i.q} ${i.u}</b></div>`).join('')}
            <h3 style="margin-top:25px;">–ö–∞–∫ –≥–æ—Ç–æ–≤–∏—Ç—å:</h3>
            ${stepsHtml}
            <button class="btn-add" onclick="addToCart(${r.id})">üõí –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
        `;
        document.getElementById('recipe-modal').classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeRecipe() {
        document.getElementById('recipe-modal').classList.remove('active');
        document.body.style.overflow = 'auto';
    }

    // –¢–∞–π–º–µ—Ä
    function startTimer(min, label) {
        alert("–¢–∞–π–º–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ " + min + " –º–∏–Ω –¥–ª—è: " + label);
    }

    // Firebase: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
    function addToCart(id) {
        const r = recipes.find(x => x.id === id
